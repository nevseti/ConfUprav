<hr>
<h2>Краткое описание</h2>
<p>Разработан эмулятор командной строки с поддержкой виртуальной файловой системы (VFS), загружаемой из XML-файла. Реализованы основные команды для работы с файлами, директориями и системными утилитами в соответствии с UNIX-подобной средой.</p>
<p>Эмулятор поддерживает два режима работы: интерактивный режим с вводом команд пользователем и режим выполнения скриптов из файла. Все операции производятся исключительно в памяти, обеспечивая изоляцию от реальной файловой системы.</p>
<hr>
<h2>Методы класса ShellEm</h2>
<ol>
<li>__init__</li>
<li>run</li>
<li>run_interactive</li>
<li>run_script</li>
<li>execute_command</li>
<li>ls</li>
<li>cd</li>
<li>cal</li>
<li>cat<li>
<li>uniq</li>
<li>uname</li>
<li>vfs-info</li>
<li>rmdir</li>
<li>cp</li>
<li>help</li>
</ol>
<hr>
<h3>__init__</h3>
<p>Инициализирует эмулятор командной строки. Устанавливает начальные параметры: текущий путь, пользователь системы, имя хоста, пути к VFS и скрипту. Загружает VFS из XML-файла при указании пути, с проверкой успешности загрузки.</p>
<h3>run</h3>
<p>Основной метод запуска эмулятора. Определяет режим работы (интерактивный или скриптовый) и передает управление соответствующему методу.</p>
<h3>run_interactive</h3>
<p>Реализует интерактивный режим работы. Отображает приглашение командной строки, обрабатывает ввод пользователя и выполняет команды в бесконечном цикле до получения команды exit.</p>
<h3>run_script</h3>
<p>Выполняет команды из внешнего файла скрипта. Читает команды построчно, пропускает пустые строки и комментарии (начинающиеся с #). Останавливает выполнение при первой ошибке.</p>
<h3>execute_command</h3>
<p>Центральный диспетчер команд. Парсит введенную строку с использованием shlex, определяет команду и передает управление соответствующему методу-обработчику.</p>
<h3>ls</h3>
<p>Отображает содержимое директории в VFS. Поддерживает указание целевого пути (абсолютного или относительного). Проверяет существование пути и то, что целевой объект является директорией.</p>
<h3>cd</h3>
<p>Изменяет текущую рабочую директорию в VFS. Поддерживает абсолютные и относительные пути, включая специальные символы "." и "..". Выполняет валидацию пути и типа объекта.</p>
<h3>cal</h3>
<p>Выводит календарь в различных форматах. Поддерживает три режима: текущий месяц, календарь на указанный год, конкретный месяц и год. Валидирует входные параметры.</p>
<h3>cat</h3>
<p>Выводит содержимое указанного файла на экран.</p>
<h3>uniq</h3>
<p>Фильтрует повторяющиеся последовательные строки в указанном файле. Читает содержимое файла из VFS, удаляет подряд идущие дубликаты и выводит результат.</p>
<h3>uname</h3>
<p>Отображает информацию о системе: операционную систему, имя хоста, текущего пользователя и версию Python.</p>
<h3>vfs-info</h3>
<p>Показывает информацию о загруженной виртуальной файловой системе: имя VFS и SHA-256 хеш исходных данных XML.</p>
<h3>rmdir</h3>
<p>Удаляет пустую директорию в VFS. Проверяет существование пути, тип объекта (должна быть директория) и отсутствие содержимого. Защищает корневую директорию от удаления.</p>
<h3>cp</h3>
<p>Копирует файлы внутри VFS. Поддерживает копирование в текущую директорию, другие директории и с переименованием. Автоматически определяет имя файла при копировании в директорию.</p>
<h3>help</h3>
<p>Выводит справочную информацию о доступных командах и их использовании.</p>
<hr>
<h2>Методы класса VirtualFileSystem</h2>
<ol>
<li>__init__</li>
<li>load_from_xml</li>
<li>_parse_folder</li>
<li>calculate_sha256</li>
<li>get_info</li>
<li>get_node</li>
<li>list_directory</li>
<li>is_directory</li>
<li>read_file</li>
<li>remove_directory</li>
<li>copy_file</li>
</ol>
<hr>
<h3>__init__</h3>
<p>Инициализирует виртуальную файловую систему. Создает корневую директорию и структуры для хранения метаданных VFS.</p>
<h3>load_from_xml</h3>
<p>Загружает VFS из XML-файла. Читает файл, парсит XML-структуру и рекурсивно строит объектную модель файловой системы в памяти. Автоматически декодирует данные в формате base64.</p>
<h3>_parse_folder</h3>
<p>Вспомогательный метод для рекурсивного парсинга XML-структуры. Обрабатывает элементы folder и file, создавая соответствующие объекты VFSFolder и VFSFile.</p>
<h3>calculate_sha256</h3>
<p>Вычисляет SHA-256 хеш исходных данных XML. Используется для проверки целостности и идентификации версии VFS.</p>
<h3>get_info</h3>
<p>Возвращает информацию о состоянии VFS: имя, хеш SHA-256 и статус загрузки.</p>
<h3>get_node</h3>
<p>Находит узел VFS по указанному пути. Выполняет навигацию по древовидной структуре, разбивая путь на компоненты.</p>
<h3>list_directory</h3>
<p>Возвращает список имен дочерних элементов указанной директории. Проверяет что путь существует и является директорией.</p>
<h3>is_directory</h3>
<p>Определяет, является ли указанный путь директорией. Проверяет тип найденного узла VFS.</p>
<h3>read_file</h3>
<p>Читает содержимое файла из VFS. Возвращает текстовое содержимое файла или None если файл не существует или не может быть прочитан.</p>
<h3>remove_directory</h3>
<p>Удаляет пустую директорию из VFS. Находит родительскую директорию и удаляет ссылку на целевую директорию.</p>
<h3>copy_file</h3>
<p>Создает копию файла в указанном месте VFS. Копирует содержимое и метаданные исходного файла в новое местоположение.</p>
<hr>
<h2>Классы структур данных VFS</h2>
<ol>
<li>VFSNode</li>
<li>VFSFile</li>
<li>VFSFolder</li>
</ol>
<hr>
<h3>VFSNode</h3>
<p>Базовый класс для всех элементов виртуальной файловой системы. Содержит общие свойства: имя и путь элемента.</p>
<h3>VFSFile</h3>
<p>Класс для представления файлов в VFS. Наследует от VFSNode, добавляет свойства: содержимое файла, кодировка и размер.</p>
<h3>VFSFolder</h3>
<p>Класс для представления директорий в VFS. Наследует от VFSNode, добавляет словарь дочерних элементов для построения древовидной структуры.</p>
<hr>
<h2>main</h2>
<hr>
<h3>main</h3>
<p>Точка входа в программу. Парсит аргументы командной строки с использованием argparse, создает экземпляр эмулятора и запускает его выполнение.</p>
<hr>
<h2>Особенности реализации</h2>
<p>Эмулятор полностью работает в памяти, не модифицируя реальную файловую систему. VFS загружается из XML-файла, где бинарные данные кодируются в base64. Поддерживается древовидная объектная модель файловой системы с строгой типизацией. Все изменения VFS происходят исключительно в памяти, соответствуя требованию изоляции. Реализована комплексная обработка ошибок с четкими сообщениями для пользователя.</p>
<h2>Описание команд для сборки проекта и запуска тестов</h2>
<p>Чтобы запустить эмулятор командной строки, вам нужен Python версии 3.7 и файл shell5.py.</p>
<p>Базовый запуск: 

```python shell.py``` - откроет интерактивную командную строку. </p>
<p>Для расширенной функциональности используйте параметры: --vfs для загрузки виртуальной файловой системы из XML-файла, например:

```python shell.py --vfs vfs.xml```

Используйте --script для автоматического выполнения команд из файла-скрипта, например:

```python shell.py --script test.txt```

Оба параметра можно комбинировать: 

```python shell.py --vfs vfs.xml --script text.txt```
 
Файлы VFS содержат структуру папок и файлов в XML-формате, а скрипты - последовательности команд для автоматического выполнения.</p>
<hr>
<h2>Примеры использования</h2>

```Run Command Line
PS C:\Users\DNS\PycharmProjects\ConfUprav> python shell5.py --vfs-path vfs-xml/stage5.xml --script test/test-stage5.txt
VFS 'stage5_test' успешно загружена из vfs-xml/stage5.xml
=== Конфигурация эмулятора ===
VFS path: vfs-xml/stage5.xml
Script path: test/test-stage5.txt
VFS name: stage5_test
VFS SHA-256: 7595e218853110733d495f77c53d57a9bd55cc3bacb1689e6101d3ec7db932bc
==============================
Выполнение скрипта: test/test-stage5.txt
--------------------------------------------------
DNS@LAPTOP-ENS5I86M:~$ ls
backup
config.dat
data.bin
etc
home
readme.txt
temp
test.txt
DNS@LAPTOP-ENS5I86M:~$ uname
Операционная система: win32
Имя устройства: LAPTOP-ENS5I86M
Пользователь: DNS
DNS@LAPTOP-ENS5I86M:~$ vfs-info
VFS name: stage5_test
SHA-256: 7595e218853110733d495f77c53d57a9bd55cc3bacb1689e6101d3ec7db932bc
DNS@LAPTOP-ENS5I86M:~$ cal
    October 2025
Mo Tu We Th Fr Sa Su
       1  2  3  4  5
 6  7  8  9 10 11 12
13 14 15 16 17 18 19
20 21 22 23 24 25 26
27 28 29 30 31

DNS@LAPTOP-ENS5I86M:~$ cal 9 2006
   September 2006
Mo Tu We Th Fr Sa Su
             1  2  3
 4  5  6  7  8  9 10
11 12 13 14 15 16 17
18 19 20 21 22 23 24
25 26 27 28 29 30

DNS@LAPTOP-ENS5I86M:~$ uniq readme.txt

        Добро пожаловать!
        Это эмулятор командной строки

DNS@LAPTOP-ENS5I86M:~$ uniq test.txt

        яблоко
        банан
        вишня
        яблоко

DNS@LAPTOP-ENS5I86M:~$ cp readme.txt readme_new.txt
Файл скопирован: '/readme.txt' -> '/readme_new.txt'
DNS@LAPTOP-ENS5I86M:~$ ls
backup
config.dat
data.bin
etc
home
readme.txt
readme_new.txt
temp
test.txt
DNS@LAPTOP-ENS5I86M:~$ cp test.txt home/test_copy.txt
Файл скопирован: '/test.txt' -> '/home/test_copy.txt'
DNS@LAPTOP-ENS5I86M:~$ ls home
test_copy.txt
user
DNS@LAPTOP-ENS5I86M:~$ ls
backup
config.dat
data.bin
etc
home
readme.txt
readme_new.txt
temp
test.txt
DNS@LAPTOP-ENS5I86M:~$ rmdir temp
DNS@LAPTOP-ENS5I86M:~$ ls
backup
config.dat
data.bin
etc
home
readme.txt
readme_new.txt
test.txt
DNS@LAPTOP-ENS5I86M:~$ exit
```
